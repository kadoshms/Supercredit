/**
 * Represents a single purchase module
 */

/**
 * Adds a new Purchase to Parse
 * 
 * @param req
 * request from server
 */
var config = require('./config');
var Kaiseki = require('./kaiseki');
var className = 'Purchases';
// instantiate
var kaiseki = new Kaiseki(config.APP_ID, config.REST_API_KEY);
/**
 * Creates a new Purchase after validation
 */
exports.newPurchase = function(req) {
	var purchase = [ {
		'userId' : req.param('userId'),
		'purchase_type' : req.param('purchase_type'),
		'purchase_amount' : req.param('purchase_amount')
	} ]
	kaiseki.createObjects(className, purchase,
			function(err, res, body, success) {
				console.log('objects created = ', body);
			});
};
/**
 * Retrives Purchases from Parse
 */
exports.getPurchasesTotalByType = function(req,callback) {
	var params = {
		where : {
			userId 			: 	req.param('userId'),
			purchase_type	:	req.param('purchase_type')
		}
	};
	var total = 0;
	kaiseki.getObjects(className, params, function(err, res, body, success) {
		var i;
		for (i = 0; i < body.length; i++) {
				total += parseFloat(body[i].purchase_amount);
		}
		callback(total)
	});
}